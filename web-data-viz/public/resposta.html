<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="imagex/png" href="assets/img/CupheadLogo.png">
    <title>Quiz</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="./js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bodyQuiz">
     
    <header class="headerLogin">
    <div class="logo"><img src="assets/img/XicrinhoDançando.gif" alt=""> Cuphead</div>
    <nav class="navegacao">
      <a href="DontDeal.html">Dont Deal With the Devil</a>
      <a href="TheDelicious.html">The Delicious Last Course</a>
      <a href="./home.html">Home</a>
      <a href="./login.html">Login</a>
      
    </nav>
  </header>

    <div class="containerLogin">
      <div id="dashboard" class="dashboardGrafic"></div>
    <div id="caixaQuiz" class="caixaLogin">
        <h2>Quiz</h2>
 
      
    

    <button onclick="iniciar()">Iniciar Quiz</button>
    <button onclick="exibirResultado()">Mostrar histórico</button>

    </div>
    </div>
</body>
<script>
const listaDeQuestoes = [
    {
      pergunta: "Qual(is) o(s) criador(es) do Cuphead",
      alternativaA: "Chad e Jared",
      alternativaB: "Mark e jeff",
      alternativaC: "Miyasaki",
      alternativaD: "Maddy e Noel",
      alternativaCorreta: "alternativaA"
    },

    {
      pergunta: "Quantos batalhas com Chefões existem no total do jogo?",
      alternativaA: "19",
      alternativaB: "21",
      alternativaC: "23",
      alternativaD: "26",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Quantos tiro diferentes são possiveis de desbloquear no jogo?",
      alternativaA: "5",
      alternativaB: "9",
      alternativaC: "8",
      alternativaD: "6",
      alternativaCorreta: "alternativaB"
    },

    {
      pergunta: "Quantos charmes diferentes são possiveis de desbloquear no jogo?",
      alternativaA: "10",
      alternativaB: "13",
      alternativaC: "9",
      alternativaD: "11",
      alternativaCorreta: "alternativaC"
    },

    {
      pergunta: "Quantas ilhas existem no total do jogo",
      alternativaA: "I",
      alternativaB: "II",
      alternativaC: "III",
      alternativaD: "IV",
      alternativaCorreta: "alternativaD"
    }

  ]

var acertosQuiz = 0; 
var contador = 0;
var final = 0;

function iniciar(){
acertosQuiz = 0;  
contador = 0;
final = 0;
   caixaQuiz.innerHTML= `
  <h2>Quiz</h2>
  ${listaDeQuestoes[0].pergunta}
  <span>   
          <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />${listaDeQuestoes[0].alternativaA}
          <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
        </span>
        <span>
          <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />${listaDeQuestoes[0].alternativaB}
          <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
        </span>
        <span>
          <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />${listaDeQuestoes[0].alternativaC}
          <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
        </span>
        <span>
          <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />${listaDeQuestoes[0].alternativaD}
          <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
        </span>
        <button onclick="avancar()">Avançar</button>
        `
}



function avancar(){
  
  
  const selecionada = document.querySelector('input[name="option"]:checked');
  if (!selecionada) {
    alert("Por favor, selecione uma alternativa antes de responder!");
    return;
  }

  // Verifica se a resposta está correta
  const respostaCorreta = listaDeQuestoes[contador].alternativaCorreta;
  if (selecionada.value === respostaCorreta) {
    alert("Resposta correta!");
    acertosQuiz++;

    
  } else {
    alert("Resposta incorreta!");
    
  }
  contador += 1;
  console.log(contador);
  if (contador == 4) {
     final =1;
  }

if (final == 1) {
if (contador == 4) {
    caixaQuiz.innerHTML= `
  <h2>Quiz</h2>
  ${listaDeQuestoes[contador].pergunta}
  <span>   
           <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />${listaDeQuestoes[contador].alternativaA}
          <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
        </span>
        <span>
           <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />${listaDeQuestoes[contador].alternativaB}
          <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
        </span>
        <span>
           <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />${listaDeQuestoes[contador].alternativaC}
          <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
        </span>
        <span>
           <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />${listaDeQuestoes[contador].alternativaD}
          <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
        </span>
        <button onclick="responder()">Responder</button>
        `
  }
}else{
  
 caixaQuiz.innerHTML= `
  <h2>Quiz</h2>
  ${listaDeQuestoes[contador].pergunta}
  <span>   
           <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />${listaDeQuestoes[contador].alternativaA}
          <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
        </span>
        <span>
           <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />${listaDeQuestoes[contador].alternativaB}
          <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
        </span>
        <span>
           <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />${listaDeQuestoes[contador].alternativaC}
          <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
        </span>
        <span>
           <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />${listaDeQuestoes[contador].alternativaD}
          <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
        </span>
        <button onclick="avancar()">Avançar</button>
        `
}
}
  
 function tentarNovamente(){
  acertosQuiz = 0;  
  contador = 0;
  final = 0;
caixaQuiz.innerHTML= `
  <h2>Quiz</h2>
  ${listaDeQuestoes[0].pergunta}
  <span>   
          <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />${listaDeQuestoes[0].alternativaA}
          <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
        </span>
        <span> 
          <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />${listaDeQuestoes[0].alternativaB}
          <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
        </span>
        <span>
          <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />${listaDeQuestoes[0].alternativaC}
          <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
        </span>
        <span>
          <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />${listaDeQuestoes[0].alternativaD}
          <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
        </span>
        <button onclick="avancar()">Avançar</button>
        `

 }
  

  function responder() {
  
  // Seleciona a alternativa marcada
  const selecionada = document.querySelector('input[name="option"]:checked');
  if (!selecionada) {
    alert("Por favor, selecione uma alternativa antes de responder!");
    return;
  }

  // Verifica se a resposta está correta
  const respostaCorreta = listaDeQuestoes[contador].alternativaCorreta;
  if (selecionada.value === respostaCorreta) {
    alert("Resposta correta!");
    acertosQuiz ++;
    
  } else {
    alert("Resposta incorreta!");
   
  }
 caixaQuiz.innerHTML= `
  <h2>Quiz</h2>
  <h2>Gostaria de ver os seus resultados?<h2>
      
        <button onclick="exibirResultado()">Resultado</button>
        <button onclick="tentarNovamente()">Tentar novamente</button>
        `
    // aguardar();
     var acertosVar = acertosQuiz;
     var fkUsuarioVar = sessionStorage.ID_USUARIO;

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo


    // Enviando o valor da nova input
    fetch("/usuarios/responder", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        acertosServer: acertosVar,
        fkUsuarioServer: fkUsuarioVar,
        idUsuario: sessionStorage.ID_USUARIO
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
         

        

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar evniar as respostas!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
     function sumirMensagem() {

  }
  }

  function exibirResultado() {
  const fkUsuario = sessionStorage.ID_USUARIO;
  caixaQuiz.innerHTML = `
    <div id="kpis" style="display: flex; gap: 30px; margin-bottom: 20px;"></div>
    <h2>Resultados das Tentativas</h2>
    <canvas id="graficoTentativas" width="400" height="200"></canvas>
    <button onclick="tentarNovamente()">Tentar novamente</button>
  `;

  fetch(`/usuarios/tentativas/${fkUsuario}`)
    .then(function(res){
     return res.json()
    })
    .then(function (dados)  {
      
      const totalTentativas = dados.length;

      let somaAcertos = 0;

for (let i = 0; i < dados.length; i++) {
  somaAcertos += dados[i].acertos;
}
  if (totalTentativas > 0) {
    var mediaAcertos = somaAcertos / totalTentativas;
  }else {
    mediaAcertos = 0;
  }

      document.getElementById('kpis').innerHTML = `
        <div class="kpi-item"><strong>Total de Tentativas:</strong> ${totalTentativas}</div>
        <div class="kpi-item"><strong>Soma de Acertos:</strong> ${somaAcertos}</div>
        <div class="kpi-item"><strong>Média de Acertos:</strong> ${mediaAcertos}</div>
      `;

     
const labels = [];
const acertos = [];

for (let i = 0; i < dados.length; i++) {
  labels.push(`Tentativa ${dados[i].numeroTentativas}`);
  acertos.push(dados[i].acertos);
}

      const ctx = document.getElementById('graficoTentativas').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Acertos por Tentativa',
            data: acertos,
            backgroundColor: '#c31c1c'
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true, max: 5 }
          }
        }
      });
    })
    .catch(err => {
      caixaQuiz.innerHTML += "<p>Erro ao carregar resultados.</p>";
      console.error(err);
    });
}

 
</script>
</html>